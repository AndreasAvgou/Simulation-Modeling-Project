import random
import matplotlib.pyplot as plt

def malware_with_immunity(N=1000, steps=300, beta=1.0, immunity_time=20):
    nodes = [0] * N
    infection_age = [0] * N
    infected_counts = []
    nodes[random.randint(0, N-1)] = 1

    for _ in range(steps):
        new_nodes = nodes.copy()
        for i in range(N):
            if nodes[i] == 1:
                infection_age[i] += 1
                if random.random() < beta:
                    target = random.randint(0, N-1)
                    if nodes[target] == 0:
                        new_nodes[target] = 1
                if infection_age[i] >= immunity_time:
                    new_nodes[i] = 2
        nodes = new_nodes
        infected_counts.append(sum(1 for x in nodes if x == 1))
    return infected_counts

if __name__ == "__main__":
    I = malware_with_immunity()
    plt.plot(I)
    plt.title("Malware Spread with Immunity")
    plt.xlabel("Time")
    plt.ylabel("Infected")
    plt.grid()
    plt.show()